@model IEnumerable<HelpingHands.Models.CareContract>
@{
    ViewData["Title"] = "New Contracts";
}




<div class="d-flex mb-2 mx-3">

    <h6 style="margin-left:22px; font-weight:600;">New Contracts</h6>

</div>

<div class="p-3 mx-3">


    <div class="filter-bg mb-3 rounded-2 p-3">
        <h5><i class="bi bi-sliders"></i> Filters</h5>
        <form method="get" class="form-inline">
            <p>Filter by Contract Date </p>
            <div class="row">
                <div class="form-group col-3">
                    <label for="startDate">Start Date:</label>
                    <input type="date" name="startDate" id="startDate" class="form-control-sm">
                </div>
                <div class="form-group col-3">
                    <label for="endDate">End Date:</label>
                    <input type="date" name="endDate" id="endDate" class="form-control-sm">
                </div>
                <div class="col-2">

                    <button type="submit" class="btn btn-success small-btn">Filter</button>

                </div>
            </div>
        </form>

    </div>
    @if (Model.Count() != 0)
    {


        <table class="table table-striped table-sm small-text" id="careContractTable">
            <thead class="thead-dark mt-3">
                <tr>
                    <th>
                        Contract Date
                    </th>
                    <th>
                        Care Status
                    </th>
                    <th>
                        Wound Condition
                    </th>
                    <th>
                        Patient
                    </th>
           
                    <th>
                        Location
                    </th>
                    <th>
                        Days Overdue
                    </th>
                    <th class="no-sort">
                        Action
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>

                        <td>
                            @item.ContractDate.Value.ToString("dd/MM/yyyy")
                        </td>
                        <td>
                            @item.CareStatus
                        </td>
                        <td>
                            @item.WoundDescription
                        </td>
                        <td>
                            @item.Patient?.FirstName @item.Patient?.LastName
                        </td>        
                        <td>
                            @item.AddressLine1 @item.AddressLine2 @item.Suburb.Name @item.Suburb.City.Name
                        </td>
                        <td>
                            @{
                                DateTime currentDate = DateTime.UtcNow;
                                TimeSpan overdueDays = currentDate - item.ContractDate.Value;
                                int daysOverdue = overdueDays.Days;
                                @daysOverdue
                            }
                        </td>
                        <td>
                            <a class="btn btn-outline-secondary rounded-3 small-btn" asp-controller="OfficeManager" asp-action="AssignContract" asp-route-Id="@item.ContractID" title="Assign Contract">
                                <i class="bi bi-arrow-up-right-circle"></i>Assign
                            </a>

                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        

    }
</div>


<script>

    $(document).ready(function () {
        $("#careContractTable").DataTable({
            "scrollY": "430px",
            "scrollCollapse": true,
            "columnDefs": [
                { "orderable": false, "targets": 'no-sort' }
            ],
            "order": [[0, "desc"]],
            "max-width": "100%"
        });




    });
</script>