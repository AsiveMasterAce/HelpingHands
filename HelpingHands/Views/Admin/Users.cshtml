@model IEnumerable<HelpingHands.Models.Users.UserModel>

@{
    ViewData["Title"] = "Users";
}

<div class="container">


<div class="d-flex mb-3">

  <h4>All Users</h4> 

  <div class="ms-auto">
      
  <a asp-action="AddUser" asp-controller="Admin" class="btn btn-success">New User</a>
  </div>
    
</div>
<div class="p-3"> 
<table class="table table-striped table-sm small-text" id="userTable">
    <thead class="thead-dark mt-3">
        <tr>
            <th>
               First Name
            </th>
            <th >
                Last Name
            </th>
            <th>
               E-Mail
            </th>
            <th class="no-sort">
              Cell Number
            </th>
            <th >
              User Type
            </th>
            <th class="no-sort"></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
        <tr>
         
            <td >
                @Html.DisplayFor(modelItem => item.FirstName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.LastName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Email)
            </td>
            <td class="">
                 @item.CellNo
            </td>
            <td>
                @item.UserType
            </td>
                

            <td>
                <a class="btn btn-warning rounded-3 small-btn" asp-controller="Admin" asp-action="EditUser" asp-route-Id="@item.UserID">
                    <i class="bi bi-pen"></i>
                </a>
                <a class="btn btn-danger rounded-3 small-btn delete-btn" data-bs-toggle="modal" data-bs-target="#DeleteModal" data-item-id="@item.UserID">
                    <i class="bi bi-trash3"></i>
               
                </a>

            </td>
        </tr>
}
    </tbody>
</table>
 </div>
</div>

<!-- Modal -->
<div class="modal fade" id="DeleteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <div class="fs-1 text-danger">
           <i class="bi bi-trash3-fill"></i>
        </div>
       <p>Are You Sure My Delete This User???</p> 
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="deleteBtn">Delete </button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<style>

  /* Define the colors */
:root {
  --color-primary: #780000;
  --color-secondary: #c1121f;
  --color-accent: #fdf0d5;
  --color-highlight: #003049;
  --color-error: #669bbc;
}

/* Apply the colors to the datatable */
.table {
  background-color: var(--color-primary);
  color: var(--color-accent);
}

.table th {
  background-color: var(--color-secondary);
  color: var(--color-accent);
}

.table td {
  background-color: var(--color-accent);
}

.table tr:hover {
  background-color: var(--color-highlight);
}

.table .error {
  background-color: var(--color-error);
  color: white;
}

/*    .dataTables_wrapper .dataTables_paginate .paginate_button {
    color: var(--color-secondary);
    background-color: var(--color-primary);
    border: 1px solid var(--color-secondary);
  }

  .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
    background-color: var(--color-secondary);
    color: var(--color-accent);
    border: 1px solid var(--color-accent);
  }

    */
  .dataTables_wrapper .dataTables_paginate .paginate_button.current {
    background-color: var(--color-highlight);
    color: var(--color-accent);
    border: 1px solid var(--color-accent);
  }

</style>

<script>

    $(document).ready(function () {
        $("#userTable").DataTable({
            "scrollY": "420px",
            "scrollCollapse": true,
            "columnDefs": [
                    { "orderable": false, "targets": 'no-sort' }
            ],
            "rowReorder": true
        });


       $('.delete-btn').click(function () {
            var itemId = $(this).data('item-id');
            console.log(itemId);
            $('#deleteBtn').data('item-id', itemId);
        });
      $("#deleteBtn").click(function () {
            var userId = $(this).data('item-id'); // Retrieve the user ID correctly

            console.log(userId);

            $.ajax({
                url: "/Admin/DeleteUser/" + userId,
                type: 'POST',
                contentType: 'application/json',
                dataType: 'json',
                //data: JSON.stringify({userId: userId}),
                success: function () {
                    window.location.href = "/Admin/Users";
                },
                error: function () {
                    alert("Error while deleting user");
                    console.log(userId);
                }
            });
        });

  });
</script>