@model IEnumerable<HelpingHands.Models.ViewModels.VisitViewModel>
@{
    ViewData["Title"] = "Contract Visits";
}


<div class="d-flex">

    <h6 class="fw-bold">My Upcoming Visits</h6>

    <div class="ms-auto">
        <a asp-action="Contract" asp-controller="Nurse" class="btn btn-danger btn-sm">Back</a>

    </div>
</div>
<div class="mt-2">


    @if (Model.Count() != 0)
    {
        <table class="table table-striped table-sm small-text">
            <thead class="thead-dark mt-3">
                <tr>
                    <th>Visit Date</th>
                    <th>Wound Condition</th>
                    <th>Notes</th>

                </tr>
            </thead>
            <tbody>
                @foreach (var visit in Model)
                {
                    <tr>
                        <td>@visit.VisitDate.Value.ToString("dd/MM/yyyy")</td>
                        <td>@visit.WoundCondition</td>
                        <td>@visit.Notes</td>
                        <td>
                            <a class="btn btn-danger rounded-3 small-btn delete-btn" data-bs-toggle="modal" data-bs-target="#DeleteModal" data-item-id="@visit.VisitId">
                                <i class="bi bi-trash3"></i>

                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        
       <div class="alert alert-info text-center">

           No Care Visits Scheduled 

        </div>
    }
</div>

<!-- Modal -->
<div class="modal fade" id="DeleteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div class="fs-1 text-danger">
                    <i class="bi bi-trash3-fill"></i>
                </div>
                <p>Are You Sure My Delete This Visit???</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="deleteBtn">Delete </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>



<script>

    $(document).ready(function () {

        $('[data-bs-toggle="modal"]').on('click', function () {
            var visitId = $(this).data('item-id');
            $('#deleteBtn').data('item-id', visitId);
        });

        $("#deleteBtn").click(function () {
            var visitId = $(this).data('item-id'); // Retrieve the user ID correctly

            console.log(visitId);

            $.ajax({
                url: "/Nurse/DeleteVisit/" + visitId,
                type: 'POST',
                contentType: 'application/json',
                dataType: 'json',
                success: function () {
                    window.location.href = "/Nurse/ContractVisits";
                },
                error: function () {
                    alert("Error while deleting user");
                    console.log(userId);
                }
            });
        });



    });
</script>